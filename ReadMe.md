# üïµÔ∏è –°—ã—â–∏–∫ –Ω–æ—Ä–º ‚Äî Video Retrieval 

–ü—Ä–æ–µ–∫—Ç –¥–ª—è **–ø–æ–∏—Å–∫–∞ ‚Äú–∏–Ω—Ç–µ—Ä–µ—Å–Ω—ã—Ö‚Äù –º–æ–º–µ–Ω—Ç–æ–≤ –≤ –≤–∏–¥–µ–æ** –∏ **—Ä–∞–Ω–∂–∏—Ä–æ–≤–∞–Ω–∏—è —Ñ—Ä–∞–≥–º–µ–Ω—Ç–æ–≤ –ø–æ —Ç–µ–∫—Å—Ç–æ–≤–æ–º—É –∑–∞–ø—Ä–æ—Å—É** (*text ‚Üí video retrieval*).

## üî• –ß—Ç–æ –¥–µ–ª–∞–µ—Ç –ø—Ä–æ–µ–∫—Ç

–û—Å–Ω–æ–≤–Ω–æ–π –ø–∞–π–ø–ª–∞–π–Ω:

1) –ë–µ—Ä—ë–º –∏—Å—Ö–æ–¥–Ω—ã–µ –≤–∏–¥–µ–æ  
2) –ù–∞—Ä–µ–∑–∞–µ–º –Ω–∞ —Å–µ–≥–º–µ–Ω—Ç—ã —Ñ–∏–∫—Å–∏—Ä–æ–≤–∞–Ω–Ω–æ–π –¥–ª–∏–Ω—ã  
3) –§–∏–ª—å—Ç—Ä—É–µ–º ‚Äú–Ω–µ–∏–Ω—Ç–µ—Ä–µ—Å–Ω—ã–µ‚Äù —Å–µ–≥–º–µ–Ω—Ç—ã (–¥–≤–∏–∂–µ–Ω–∏–µ / —á–µ–ª–æ–≤–µ–∫ –≤ –∫–∞–¥—Ä–µ)  
4) –°—á–∏—Ç–∞–µ–º —ç–º–±–µ–¥–¥–∏–Ω–≥–∏ —Å–µ–≥–º–µ–Ω—Ç–æ–≤ (XCLIP / CLIP backend)  
5) –ü–æ —Ç–µ–∫—Å—Ç–æ–≤–æ–º—É –∑–∞–ø—Ä–æ—Å—É —Å–æ—Ä—Ç–∏—Ä—É–µ–º —Å–µ–≥–º–µ–Ω—Ç—ã –ø–æ similarity

---

## üöÄ –í–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏

- ‚úÖ –ù–∞—Ä–µ–∑–∫–∞ –≤–∏–¥–µ–æ –Ω–∞ —Å–µ–≥–º–µ–Ω—Ç—ã (`segment_seconds`)
- ‚úÖ Motion filter (–¥–≤–∏–∂–µ–Ω–∏–µ –≤ –∫–∞–¥—Ä–µ)
- ‚úÖ Person filter (—á–µ–ª–æ–≤–µ–∫ –≤ –∫–∞–¥—Ä–µ —á–µ—Ä–µ–∑ YOLO, COCO class=0)
- ‚úÖ –ò–Ω–¥–µ–∫—Å–∞—Ü–∏—è —Å–µ–≥–º–µ–Ω—Ç–æ–≤ (—ç–º–±–µ–¥–¥–∏–Ω–≥–∏)
- ‚úÖ –ü–æ–∏—Å–∫ –ø–æ —Ç–µ–∫—Å—Ç—É: *‚ÄúVandalism‚Äù, ‚ÄúPerson running‚Äù, ‚ÄúCar crash‚Äù‚Ä¶*
- ‚úÖ –ö–µ—à–∏—Ä–æ–≤–∞–Ω–∏–µ –ø—Ä–æ–º–µ–∂—É—Ç–æ—á–Ω—ã—Ö —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤ (—É—Å–∫–æ—Ä—è–µ—Ç –ø–æ–≤—Ç–æ—Ä–Ω—ã–µ –∑–∞–ø—É—Å–∫–∏)
- ‚úÖ –ü–æ–¥–¥–µ—Ä–∂–∫–∞ ROI (–æ–±–ª–∞—Å—Ç—å –∏–Ω—Ç–µ—Ä–µ—Å–∞)

---

## üì¶ –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø—Ä–æ–µ–∫—Ç–∞

```
.
‚îú‚îÄ‚îÄ main.py                    # –æ—Å–Ω–æ–≤–Ω–æ–π –≤—Ö–æ–¥
‚îú‚îÄ‚îÄ batch_run.py               # –æ–±—Ä–∞–±–æ—Ç–∫–∞ –ø–∞–ø–∫–∏ —Å –≤–∏–¥–µ–æ (batch)
‚îú‚îÄ‚îÄ run_one_video.py           # –æ–±—Ä–∞–±–æ—Ç–∫–∞ –æ–¥–Ω–æ–≥–æ –≤–∏–¥–µ–æ
‚îú‚îÄ‚îÄ index_video.py             # –∏–Ω–¥–µ–∫—Å–∞—Ü–∏—è —Å–µ–≥–º–µ–Ω—Ç–æ–≤
‚îú‚îÄ‚îÄ retrieve.py                # —Ä–∞–Ω–∂–∏—Ä–æ–≤–∞–Ω–∏–µ –ø–æ —Ç–µ–∫—Å—Ç–æ–≤–æ–º—É –∑–∞–ø—Ä–æ—Å—É
‚îú‚îÄ‚îÄ motion_detect.py           # —Ñ–∏–ª—å—Ç—Ä –¥–≤–∏–∂–µ–Ω–∏—è
‚îú‚îÄ‚îÄ person_detect.py           # —Ñ–∏–ª—å—Ç—Ä —á–µ–ª–æ–≤–µ–∫–∞ (YOLO)
‚îú‚îÄ‚îÄ visualize_results.py       # –≤–∏–∑—É–∞–ª–∏–∑–∞—Ü–∏—è —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤
‚îú‚îÄ‚îÄ cache_io.py                # –∫–µ—à –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–∏ / —á—Ç–µ–Ω–∏–µ/–∑–∞–ø–∏—Å—å –∫–µ—à–∞
‚îú‚îÄ‚îÄ config.py                  # CLI + –∫–æ–Ω—Ñ–∏–≥–∏
‚îú‚îÄ‚îÄ defaults.py                # —É—Ç–∏–ª–∏—Ç—ã –ø–æ–¥—Å—Ç–∞–Ω–æ–≤–∫–∏ –∑–Ω–∞—á–µ–Ω–∏–π
‚îî‚îÄ‚îÄ models/
    ‚îú‚îÄ‚îÄ base.py                # –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å backend'–æ–≤
    ‚îú‚îÄ‚îÄ clip_frame_backend.py  # frame-based CLIP backend
    ‚îú‚îÄ‚îÄ xclip_backend.py       # video-text XCLIP backend
    ‚îú‚îÄ‚îÄ dummy_backend.py       # –∑–∞–≥–ª—É—à–∫–∞
    ‚îî‚îÄ‚îÄ registry.py            # —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è backend'–æ–≤
```

---

## ‚öôÔ∏è –£—Å—Ç–∞–Ω–æ–≤–∫–∞

### 1) Python –æ–∫—Ä—É–∂–µ–Ω–∏–µ
–†–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è Python **3.9+**.

```bash
python -m venv venv
source venv/bin/activate      # Linux/Mac
venv\Scripts\activate         # Windows
```

### 2) –ó–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏
–ü–æ –∏–º–ø–æ—Ä—Ç—É –≤ –ø—Ä–æ–µ–∫—Ç–µ –∏—Å–ø–æ–ª—å–∑—É—é—Ç—Å—è:

- `opencv-python` (`cv2`)
- `numpy`
- `torch`
- `transformers`
- `ultralytics` (YOLO, –¥–ª—è `person_detect`)
- `tqdm`

–£—Å—Ç–∞–Ω–æ–≤–∫–∞ (–ø—Ä–∏–º–µ—Ä–Ω–æ):

```bash
pip install opencv-python numpy torch transformers tqdm ultralytics
```

‚ö†Ô∏è –ï—Å–ª–∏ —É —Ç–µ–±—è CUDA ‚Äî —Å—Ç–∞–≤—å PyTorch –ø–æ–¥ —Å–≤–æ—é –≤–µ—Ä—Å–∏—é CUDA.

---

## ‚ñ∂Ô∏è –ó–∞–ø—É—Å–∫

### Batch (–ø–∞–ø–∫–∞ —Å –≤–∏–¥–µ–æ/—Å–µ–≥–º–µ–Ω—Ç–∞–º–∏)
```bash
python main.py --mode batch --video video_split --query "Vandalism"
```

–ì–¥–µ:
- `--mode batch` ‚Äî –æ–±—Ä–∞–±–æ—Ç–∫–∞ –Ω–∞–±–æ—Ä–∞ –≤–∏–¥–µ–æ
- `--video video_split` ‚Äî –ø–∞–ø–∫–∞ —Å –≤–∏–¥–µ–æ (–∏–ª–∏ —Å–µ–≥–º–µ–Ω—Ç–∞–º–∏)
- `--query "..."` ‚Äî —Ç–µ–∫—Å—Ç–æ–≤—ã–π –∑–∞–ø—Ä–æ—Å

---

## üß© –ö–∞–∫ —Ä–∞–±–æ—Ç–∞–µ—Ç –ø–∞–π–ø–ª–∞–π–Ω (–ø–æ–¥—Ä–æ–±–Ω–µ–µ)

### 1) –ù–∞—Ä–µ–∑–∫–∞ –≤–∏–¥–µ–æ
–ö–∞–∂–¥–æ–µ –≤–∏–¥–µ–æ –¥–µ–ª–∏—Ç—Å—è –Ω–∞ —Å–µ–≥–º–µ–Ω—Ç—ã –ø–æ `segment_seconds`.

### 2) –§–∏–ª—å—Ç—Ä –¥–≤–∏–∂–µ–Ω–∏—è (motion_detect)
–°–µ–≥–º–µ–Ω—Ç —Å—á–∏—Ç–∞–µ—Ç—Å—è ‚Äú–∏–Ω—Ç–µ—Ä–µ—Å–Ω—ã–º‚Äù, –µ—Å–ª–∏ –≤ –Ω—ë–º –µ—Å—Ç—å –¥–≤–∏–∂–µ–Ω–∏–µ, –∫–æ—Ç–æ—Ä–æ–µ –¥–ª–∏—Ç—Å—è –Ω–µ –º–µ–Ω—å—à–µ `min_motion_seconds`.

### 3) –§–∏–ª—å—Ç—Ä —á–µ–ª–æ–≤–µ–∫–∞ (person_detect)
–ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –¥–µ—Ç–µ–∫—Ç–æ—Ä (YOLO).  
–ï—Å–ª–∏ —á–µ–ª–æ–≤–µ–∫ –Ω–∞–π–¥–µ–Ω (COCO class=0) ‚Üí —Å–µ–≥–º–µ–Ω—Ç –æ—Å—Ç–∞—ë—Ç—Å—è.

### 4) –ò–Ω–¥–µ–∫—Å–∞—Ü–∏—è —Å–µ–≥–º–µ–Ω—Ç–æ–≤
–î–ª—è –∫–∞–∂–¥–æ–≥–æ —Å–µ–≥–º–µ–Ω—Ç–∞ —Å—á–∏—Ç–∞–µ—Ç—Å—è embedding (–≤–µ–∫—Ç–æ—Ä –ø—Ä–∏–∑–Ω–∞–∫–æ–≤).  
–≠—Ç–æ –¥–µ–ª–∞–µ—Ç—Å—è —á–µ—Ä–µ–∑ backend –∏–∑ `models/`.

### 5) –ü–æ–∏—Å–∫ –ø–æ —Ç–µ–∫—Å—Ç—É
–¢–µ–∫—Å—Ç–æ–≤—ã–π –∑–∞–ø—Ä–æ—Å –ø–µ—Ä–µ–≤–æ–¥–∏—Ç—Å—è –≤ embedding, –∑–∞—Ç–µ–º —Å—á–∏—Ç–∞–µ—Ç—Å—è similarity –º–µ–∂–¥—É —Ç–µ–∫—Å—Ç–æ–º –∏ –∫–∞–∂–¥—ã–º —Å–µ–≥–º–µ–Ω—Ç–æ–º.  
–†–µ–∑—É–ª—å—Ç–∞—Ç—ã —Å–æ—Ä—Ç–∏—Ä—É—é—Ç—Å—è –ø–æ —É–±—ã–≤–∞–Ω–∏—é similarity.

---

## üß† Backends (–º–æ–¥–µ–ª–∏)

### XCLIP backend (—Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è –¥–ª—è –∫–∞—á–µ—Å—Ç–≤–∞)
–§–∞–π–ª: `models/xclip_backend.py`

–ü–ª—é—Å—ã:
- –ª—É—á—à–µ –ø–æ–Ω–∏–º–∞–µ—Ç –¥–∏–Ω–∞–º–∏–∫—É

–ú–∏–Ω—É—Å—ã:
- —Ç—è–∂–µ–ª–µ–µ –ø–æ —Ä–µ—Å—É—Ä—Å–∞–º, –æ—Å–æ–±–µ–Ω–Ω–æ –Ω–∞ CPU

### Frame-based CLIP backend
–§–∞–π–ª: `models/clip_frame_backend.py`

–ü–ª—é—Å—ã:
- –±—ã—Å—Ç—Ä–µ–µ

–ú–∏–Ω—É—Å—ã:
- —Ö—É–∂–µ —Ä–∞–±–æ—Ç–∞–µ—Ç —Å –¥–∏–Ω–∞–º–∏–∫–æ–π (–¥–≤–∏–∂–µ–Ω–∏–µ, –¥–µ–π—Å—Ç–≤–∏—è)

---

## üóÇÔ∏è –ö–µ—à–∏—Ä–æ–≤–∞–Ω–∏–µ

–ü—Ä–æ–µ–∫—Ç –∏—Å–ø–æ–ª—å–∑—É–µ—Ç –∫–µ—à –¥–ª—è:
- —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è –Ω–∞—Ä–µ–∑–∞–Ω–Ω—ã—Ö —Å–µ–≥–º–µ–Ω—Ç–æ–≤
- —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è —ç–º–±–µ–¥–¥–∏–Ω–≥–æ–≤
- —É—Å–∫–æ—Ä–µ–Ω–∏—è –ø–æ–≤—Ç–æ—Ä–Ω–æ–≥–æ –ø–æ–∏—Å–∫–∞ –ø–æ –Ω–æ–≤—ã–º –∑–∞–ø—Ä–æ—Å–∞–º

–ï—Å–ª–∏ —Ç—ã –º–µ–Ω—è–µ—à—å –ø–∞—Ä–∞–º–µ—Ç—Ä—ã preprocess ‚Äî –ª—É—á—à–µ —á–∏—Å—Ç–∏—Ç—å –∫–µ—à.

---

## üß™ –ü—Ä–∏–º–µ—Ä—ã –∑–∞–ø—Ä–æ—Å–æ–≤

```bash
python main.py --mode batch --video video_split --query "Person running"
python main.py --mode batch --video video_split --query "Fight"
python main.py --mode batch --video video_split --query "Car accident"
python main.py --mode batch --video video_split --query "Vandalism"
```

---

## ‚ùó –ß–∞—Å—Ç—ã–µ –ø—Ä–æ–±–ª–µ–º—ã

### ‚ÄúNo module named cv2‚Äù
```bash
pip install opencv-python
```

### YOLO –Ω–µ —Ä–∞–±–æ—Ç–∞–µ—Ç / –Ω–µ –Ω–∞–π–¥–µ–Ω—ã –≤–µ—Å–∞
–ü—Ä–æ–≤–µ—Ä—å:
- —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∞ –ª–∏ –±–∏–±–ª–∏–æ—Ç–µ–∫–∞ (`ultralytics`)
- —Å–∫–∞—á–∞–Ω—ã –ª–∏ –≤–µ—Å–∞
- –¥–æ—Å—Ç—É–ø–Ω–∞ –ª–∏ –≤–∏–¥–µ–æ–∫–∞—Ä—Ç–∞ (–µ—Å–ª–∏ —Ä–∞—Å—Å—á–∏—Ç—ã–≤–∞–µ—à—å –Ω–∞ GPU)

### –û—á–µ–Ω—å –º–µ–¥–ª–µ–Ω–Ω–æ –Ω–∞ CPU
–†–µ—à–µ–Ω–∏—è:
- –æ—Ç–∫–ª—é—á–∏—Ç—å `person_detect`
- —É–≤–µ–ª–∏—á–∏—Ç—å `segment_seconds`
- –ø–µ—Ä–µ–π—Ç–∏ –Ω–∞ CLIP frame backend
- –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å CUDA

---

## üìå –ú–∏–Ω–∏–º–∞–ª—å–Ω—ã–π —Å—Ç–∞—Ä—Ç

```bash
python main.py --mode batch --video video_split --query "Vandalism"
```

---

## üìú Attribution (RU‚ÜíEN –ø–µ—Ä–µ–≤–æ–¥—á–∏–∫)

–î–ª—è –ø–µ—Ä–µ–≤–æ–¥–∞ —Ä—É—Å—Å–∫–∏—Ö –∑–∞–ø—Ä–æ—Å–æ–≤ –≤ –∞–Ω–≥–ª–∏–π—Å–∫–∏–π (–ø–µ—Ä–µ–¥ CLIP/XCLIP retrieval) –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è open‚Äësource –º–æ–¥–µ–ª—å –º–∞—à–∏–Ω–Ω–æ–≥–æ –ø–µ—Ä–µ–≤–æ–¥–∞:

- **–ú–æ–¥–µ–ª—å:** `Helsinki-NLP/opus-mt-ru-en` (OPUS‚ÄëMT / MarianMT)
- **–ê–≤—Ç–æ—Ä—ã (recommended citation):** J√∂rg Tiedemann & Santhosh Thottingal ‚Äî *‚ÄúOPUS‚ÄëMT ‚Äî Building open translation services for the World‚Äù*, EAMT 2020
- **–õ–∏—Ü–µ–Ω–∑–∏—è –º–æ–¥–µ–ª–∏:** **CC‚ÄëBY 4.0** (—Ç—Ä–µ–±—É–µ—Ç —É–∫–∞–∑–∞–Ω–∏—è –∞–≤—Ç–æ—Ä—Å—Ç–≤–∞)

–ò—Å—Ç–æ—á–Ω–∏–∫/–∫–∞—Ä—Ç–æ—á–∫–∞ –º–æ–¥–µ–ª–∏: Hugging Face `Helsinki-NLP/opus-mt-ru-en`.
